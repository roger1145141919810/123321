<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸº ç‹¼äººæ®ºè¯ç·šç‰ˆ - é€²éšè¦–è¦ºç‰ˆ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        /* åŸºç¤å¤–è§€èˆ‡å¹³æ»‘è®Šè‰²å‹•ç•« */
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background: #2c3e50; 
            color: white; 
            text-align: center; 
            margin: 0; 
            padding: 20px;
            transition: background 1.5s ease, color 1.5s ease; 
        }

        /* ã€å¤œæ™šæ¨¡å¼ã€‘æ·±è—è‰² */
        body.night {
            background: #1a1a2e !important;
            color: #e94560 !important;
        }

        /* ã€ç™½å¤©æ¨¡å¼ã€‘æš–æ©˜è‰² */
        body.day {
            background: #f39c12 !important;
            color: #2c3e50 !important;
        }

        header { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 10px; margin-bottom: 20px; }
        section { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 10px auto; max-width: 500px; }
        
        button { 
            padding: 12px 20px; margin: 10px; border-radius: 5px; border: none; 
            font-size: 16px; background: #e94560; color: white; cursor: pointer; font-weight: bold; 
        }
        button:disabled { background: #555; }
        
        input { padding: 12px; width: 60%; border-radius: 5px; border: none; margin-bottom: 10px; }
        
        ul { list-style: none; padding: 0; }
        li { background: rgba(0,0,0,0.2); padding: 10px; margin: 5px 0; border-radius: 5px; display: flex; justify-content: space-between; }
        
        .role-box { font-size: 28px; color: #f1c40f; font-weight: bold; margin: 15px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        #logContent { 
            height: 150px; overflow-y: auto; background: rgba(0,0,0,0.3); 
            padding: 10px; border-radius: 5px; text-align: left; font-size: 14px; 
        }
    </style>
</head>
<body class="">

    <header>
        <h1>ğŸº ç‹¼äººæ®ºï¼šè¯ç·šå°æˆ°</h1>
    </header>

    <section id="setup">
        <h2>æº–å‚™é€²å…¥æ‘èŠ</h2>
        <input type="text" id="username" placeholder="è«‹è¼¸å…¥ä½ çš„æš±ç¨±">
        <br>
        <button id="joinBtn">åŠ å…¥éŠæˆ²</button>
    </section>

    <main id="game" hidden>
        <section id="status">
            <div id="myRole" class="role-box">ç­‰å¾…æ³•å®˜ç™¼ç‰Œ...</div>
            <p>ç›®å‰æ™‚é–“ï¼š<span id="roundDisplay">ç­‰å¾…ä¸­</span></p>
            <button id="startBtn">æˆ¿é•·ï¼šé–‹å§‹ç™¼ç‰Œ</button>
        </section>

        <section id="players">
            <h3>å­˜æ´»ç©å®¶ (<span id="aliveCount">0</span>)</h3>
            <ul id="playerList"></ul>
        </section>

        <section id="log">
            <h3>æ‘èŠç´€éŒ„</h3>
            <div id="logContent"></div>
        </section>
    </main>

    <script>
        // ã€é‡è¦ã€‘è«‹ç¢ºèªé€™æ˜¯ä½  Render çš„ç¶²å€
        const RENDER_URL = "https://were-wolf.onrender.com"; 
        const socket = io(RENDER_URL);

        const joinBtn = document.getElementById("joinBtn");
        const startBtn = document.getElementById("startBtn");
        const setup = document.getElementById("setup");
        const game = document.getElementById("game");
        const playerList = document.getElementById("playerList");
        const myRoleDisplay = document.getElementById("myRole");
        const logContent = document.getElementById("logContent");
        const roundDisplay = document.getElementById("roundDisplay");

        // 1. é»æ“ŠåŠ å…¥
        joinBtn.onclick = () => {
            const name = document.getElementById("username").value;
            if (!name) return alert("è«‹è¼¸å…¥åå­—ï¼");
            socket.emit('joinGame', name);
            setup.hidden = true;
            game.hidden = false;
            log("æ­£åœ¨é€£ç·šè‡³é ç«¯æ³•å®˜...");
        };

        // 2. é»æ“Šé–‹å§‹ (åƒ…é™æˆ¿é•·)
        startBtn.onclick = () => {
            socket.emit('startGame');
        };

        // 3. æ¥æ”¶ç©å®¶åå–®
        socket.on('updatePlayers', (players) => {
            playerList.innerHTML = "";
            players.forEach(p => {
                const li = document.createElement("li");
                li.innerHTML = `<span>ğŸ‘¤ ${p.name}</span> <span>å·²å°±ç·’</span>`;
                playerList.appendChild(li);
            });
            document.getElementById("aliveCount").textContent = players.length;
        });

        // 4. æ¥æ”¶èº«åˆ†ç™¼æ”¾ (åŒæ™‚è§¸ç™¼å¤©é»‘)
        socket.on('assignRole', (role) => {
            myRoleDisplay.innerText = "ä½ çš„èº«åˆ†æ˜¯ï¼š" + role;
            
            // è¦–è¦ºåˆ‡æ›ï¼šè®Šå¤©é»‘
            document.body.className = "night";
            roundDisplay.innerText = "å¤œæ™š";
            
            log("æ³•å®˜å·²ç™¼ç‰Œï¼Œå¤©é»‘è«‹é–‰çœ¼...");
            startBtn.style.display = "none"; 
        });

        // 5. æ¥æ”¶æ™å¤œåˆ‡æ›å»£æ’­
        socket.on('changePhase', (data) => {
            // data æœƒæ˜¯ 'day' æˆ– 'night'
            document.body.className = data;
            roundDisplay.innerText = (data === 'day' ? "ç™½å¤©" : "å¤œæ™š");
            log(`ã€æ³•å®˜å…¬å‘Šã€‘å¤© ${data === 'day' ? 'äº®' : 'é»‘'} äº†ï¼`);
        });

        // ç´€éŒ„è¨Šæ¯å·¥å…·
        function log(msg) {
            const p = document.createElement("p");
            p.textContent = `> ${msg}`;
            logContent.appendChild(p);
            logContent.scrollTop = logContent.scrollHeight;
        }

        socket.on('connect_error', () => {
            log("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Render ä¼ºæœå™¨æ˜¯å¦å•Ÿå‹•ã€‚");
        });
    </script>
</body>
</html>
