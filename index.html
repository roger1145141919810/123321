<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini ç‹¼äººæ®ºç³»çµ±</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: sans-serif; transition: 0.5s; background: #f0f0f0; }
        .night { background: #1a1a2e; color: white; }
        #game-container { display: flex; gap: 20px; padding: 20px; }
        #player-list { width: 300px; border: 1px solid #ccc; padding: 10px; border-radius: 8px; }
        .player-card { padding: 10px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; }
        .dead { background: #555 !important; text-decoration: line-through; color: #888; }
        #chat-box { flex-grow: 1; height: 400px; border: 1px solid #ccc; overflow-y: auto; background: white; color: black; }
        .system-msg { color: #d9534f; font-weight: bold; }
    </style>
</head>
<body>
    <div id="setup">
        <input id="username" placeholder="æš±ç¨±">
        <input id="room-id" placeholder="æˆ¿é–“è™Ÿ">
        <button onclick="join()">åŠ å…¥æˆ¿é–“</button>
    </div>

    <div id="game-ui" style="display:none;">
        <h2 id="phase-title">ç­‰å¾…é–‹å±€...</h2>
        <div id="timer">å€’æ•¸: --</div>
        <div id="my-role">æˆ‘çš„èº«åˆ†: æœªçŸ¥</div>
        
        <div id="game-container">
            <div id="player-list">
                <h3>ç©å®¶åˆ—è¡¨ (é»æ“Šé ­åƒç™¼å‹•æŠ€èƒ½)</h3>
                <div id="players"></div>
            </div>
            <div id="chat-section">
                <div id="chat-box"></div>
                <input id="msg-input" placeholder="è¼¸å…¥è¨Šæ¯...">
                <button onclick="send()">é€å‡º</button>
                <button id="start-btn" onclick="start()" style="display:none;">é–‹å§‹éŠæˆ²</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let myId, myRole, currentStatus;

        function join() {
            const username = document.getElementById('username').value;
            const roomId = document.getElementById('room-id').value;
            socket.emit('joinRoom', { roomId, username });
            document.getElementById('setup').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
        }

        function start() { socket.emit('startGame'); }

        socket.on('assignRole', role => {
            myRole = role;
            document.getElementById('my-role').innerText = `æˆ‘çš„èº«åˆ†: ${role}`;
        });

        socket.on('phaseChange', status => {
            currentStatus = status;
            document.body.className = status === 'night' ? 'night' : '';
            document.getElementById('phase-title').innerText = status === 'night' ? 'ğŸŒ™ é»‘å¤œéšæ®µ' : 'â˜€ï¸ ç™½å¤©è¨è«–';
        });

        socket.on('updatePlayers', players => {
            const list = document.getElementById('players');
            list.innerHTML = '';
            players.forEach(p => {
                if(p.id === socket.id && rooms[p.id]?.hostId === p.id) document.getElementById('start-btn').style.display = 'block';
                const div = document.createElement('div');
                div.className = `player-card ${p.isAlive ? '' : 'dead'}`;
                div.innerText = `${p.username}`;
                div.onclick = () => useSkill(p.id);
                list.appendChild(div);
            });
        });

        function useSkill(targetId) {
            if (currentStatus !== 'night') return;
            let type = '';
            if (myRole === 'ç‹¼äºº') type = 'wolfKill';
            else if (myRole === 'é è¨€å®¶') type = 'check';
            else if (myRole === 'å®ˆè¡›') type = 'guard';
            
            if (type) socket.emit('submitAction', { type, targetId });
        }

        socket.on('timerUpdate', time => { document.getElementById('timer').innerText = `å€’æ•¸: ${time}s`; });

        socket.on('receiveMessage', data => {
            const box = document.getElementById('chat-box');
            const p = document.createElement('p');
            if(data.isSystem) p.className = 'system-msg';
            p.innerText = `${data.name}: ${data.text}`;
            box.appendChild(p);
            box.scrollTop = box.scrollHeight;
        });

        function send() {
            const input = document.getElementById('msg-input');
            socket.emit('sendMessage', input.value);
            input.value = '';
        }
    </script>
</body>
</html>
