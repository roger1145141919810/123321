<style>
    /* ... ä¿æŒä½ åŸæœ¬çš„ CSSï¼Œä¸¦æ–°å¢/ä¿®æ”¹ä»¥ä¸‹ ... */
    
    /* è‡ªé¸ç›®æ¨™ï¼šé‡‘é»ƒè‰²å¤–æ¡† */
    .target-self {
        border: 2px solid var(--accent-gold) !important;
        background: rgba(241, 196, 15, 0.15) !important;
    }

    /* éšŠå‹ç›®æ¨™ï¼šç´…è‰²å¤–æ¡† */
    .target-teammate {
        border: 2px solid var(--primary-red) !important;
        background: rgba(233, 69, 96, 0.15) !important;
    }

    /* å·²ç¢ºèªæ¨™ç±¤ */
    .confirm-tag {
        background: var(--primary-green);
        color: white;
        font-size: 10px;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 5px;
    }

    .confirm-btn-big {
        width: 100%;
        margin-top: 10px;
        padding: 12px;
        background: var(--primary-green);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
    }
    .confirm-btn-big:disabled { background: #555; opacity: 0.6; }
</style>

<script>
    // --- æ–°å¢å…¨åŸŸè®Šæ•¸ ---
    let wolfStatusData = []; // æ ¼å¼: [{id, targetId, isConfirmed}]
    let lastPlayersData = []; // ç·©å­˜ç©å®¶åˆ—è¡¨
    let currentStatus = "waiting";

    // --- ç›£è½ç‹¼äººå³æ™‚è³‡è¨Š ---
    socket.on('updateWolfUI', (data) => {
        wolfStatusData = data;
        renderList(); // æ”¶åˆ°æ›´æ–°å³é‡ç¹ªåå–®
    });

    socket.on('updatePlayers', ({ players, status, nightAction }) => {
        lastPlayersData = players;
        currentStatus = status;
        
        // åŒæ­¥è—¥æ°´ç‹€æ…‹
        if (nightAction) {
            witchPotions.hasSave = nightAction.witchHasSave;
            witchPotions.hasPoison = nightAction.witchHasPoison;
        }

        // ä»‹é¢åˆ‡æ›è™•ç†
        document.getElementById("setup").classList.add("hidden");
        document.getElementById("game").classList.remove("hidden");
        
        const me = players.find(p => p.id === socket.id);
        if(me) { isAlive = me.isAlive; amIHost = me.isHost; }

        // è™•ç†é»‘å¤œ/ç™½å¤©æ¨¡å¼åˆ‡æ›
        if(status.startsWith('night')) {
            document.body.classList.add("night-mode");
            document.getElementById("chatInput").disabled = true;
        } else {
            document.body.classList.remove("night-mode");
            document.getElementById("chatInput").disabled = !isAlive;
            wolfStatusData = []; // æ¸…ç©ºé»‘å¤œç·©å­˜
            document.getElementById("skipBtn").disabled = false; // é‡ç½®è·³éæŒ‰éˆ•
            document.getElementById("skipBtn").innerText = "â­ï¸ è·³éç™¼è¨€";
        }

        // ç‹¼äººå°ˆå±¬ä»‹é¢
        document.getElementById("wolfSection").classList.toggle("hidden", myRole !== 'ç‹¼äºº');
        
        renderList();
    });

    function renderList() {
        const list = document.getElementById("playerList");
        list.innerHTML = "";
        
        lastPlayersData.forEach(p => {
            const div = document.createElement("div");
            div.className = `player-item ${!p.isAlive ? 'dead' : ''}`;
            
            // ç‹¼äººå°ˆç”¨ï¼šåˆ¤æ–·é¡è‰²
            if (currentStatus === 'night_wolf' && myRole === 'ç‹¼äºº') {
                const myInfo = wolfStatusData.find(d => d.id === socket.id);
                const teammateInfo = wolfStatusData.find(d => d.id !== socket.id);
                
                if (p.id === myInfo?.targetId) div.classList.add('target-self');
                else if (p.id === teammateInfo?.targetId) div.classList.add('target-teammate');
            }

            // é¡¯ç¤ºç¢ºèªç‹€æ…‹ (ç‹¼äººéšŠå‹åå­—æ—)
            let confirmTag = "";
            if (currentStatus === 'night_wolf' && myRole === 'ç‹¼äºº') {
                const info = wolfStatusData.find(d => d.id === p.id);
                if (info?.isConfirmed) confirmTag = `<span class="confirm-tag">å·²é–å®š</span>`;
            }

            const nameClass = (myRole === 'ç‹¼äºº' && p.role === 'ç‹¼äºº') ? 'is-wolf' : '';
            let html = `<span>${p.isHost ? 'ğŸ‘‘' : ''} <span class="${nameClass}">${p.name}</span> ${confirmTag}</span><div>`;

            // æŒ‰éˆ•é¡¯ç¤ºé‚è¼¯
            if (isAlive && p.isAlive) {
                if (currentStatus === 'night_wolf' && myRole === 'ç‹¼äºº') {
                    html += `<button class="action-btn btn-kill" onclick="socket.emit('wolfKill','${p.id}')">é¸æ“‡</button>`;
                }
                if (currentStatus === 'night_witch' && myRole === 'å¥³å·«') {
                    html += `<button class="action-btn" style="background:#27ae60" ${!witchPotions.hasSave ? 'disabled' : ''} onclick="socket.emit('witchAction',{type:'save',targetId:'${p.id}'})">æ•‘äºº</button>`;
                    html += `<button class="action-btn" style="background:#c0392b" ${!witchPotions.hasPoison ? 'disabled' : ''} onclick="socket.emit('witchAction',{type:'poison',targetId:'${p.id}'})">æ¯’æ®º</button>`;
                }
                // ...å…¶é¤˜æŒ‰éˆ•(é è¨€å®¶ã€æŠ•ç¥¨)ä¿æŒä¸è®Š...
            }
            div.innerHTML = html + `</div>`;
            list.appendChild(div);
        });

        // ç‹¼äººç¢ºèªæŒ‰éˆ• (åœ¨å¤§åå–®ä¸‹æ–¹)
        if (currentStatus === 'night_wolf' && myRole === 'ç‹¼äºº' && isAlive) {
            const myInfo = wolfStatusData.find(d => d.id === socket.id);
            const cBtn = document.createElement("button");
            cBtn.className = "confirm-btn-big";
            cBtn.innerText = myInfo?.isConfirmed ? "âœ… ç­‰å¾…éšŠå‹ç¢ºèª..." : "ğŸ”’ ç¢ºèªæ“Šæ®ºç›®æ¨™";
            cBtn.disabled = !myInfo?.targetId || myInfo?.isConfirmed;
            cBtn.onclick = () => socket.emit('wolfConfirm');
            list.appendChild(cBtn);
        }
    }

    function handleSkip() {
        socket.emit('castSkipVote');
        const btn = document.getElementById("skipBtn");
        btn.disabled = true;
        btn.innerText = "â³ å·²è«‹æ±‚è·³é";
    }
    
    // å°‡ HTML ä¸­çš„ onclick="socket.emit('castSkipVote')" æ”¹ç‚º onclick="handleSkip()"
</script>
